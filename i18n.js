// Internationalization (i18n) Support
const translations = {
  en: {
    // Navigation
    home: "Home",
    resources: "Resources",
    student: "Student",
    tutor: "Tutor",
    logout: "Logout",
    
    // Common
    welcome: "Welcome",
    loading: "Loading...",
    save: "Save",
    cancel: "Cancel",
    delete: "Delete",
    edit: "Edit",
    share: "Share",
    search: "Search",
    
    // Homepage
    heroTitle: "Equal Learning Opportunities for All",
    heroSubtitle: "Connecting students with volunteer tutors for free online learning.",
    getStarted: "Get Started",
    
    // Resources
    shareResource: "Share Resource",
    myResources: "My Resources",
    allResources: "All Resources",
    resourceTitle: "Title",
    resourceDescription: "Description",
    resourceCategory: "Category",
    resourceUrl: "URL",
    
    // Progress
    myProgress: "My Progress",
    subject: "Subject",
    topic: "Topic",
    progress: "Progress",
    completed: "Completed",
    inProgress: "In Progress",
    notStarted: "Not Started",
    
    // Language
    selectLanguage: "Select Language",
    language: "Language",
    
    // Features
    whyChoose: "Why Choose EduBridge?",
    freeLearning: "Free Learning",
    freeLearningDesc: "Access quality education without financial barriers",
    expertTutors: "Expert Tutors",
    expertTutorsDesc: "Learn from passionate volunteer educators",
    onlinePlatform: "Online Platform",
    onlinePlatformDesc: "Study from anywhere, anytime",
    progressTracking: "Progress Tracking",
    progressTrackingDesc: "Monitor your learning journey",
    studentsHelped: "Students Helped",
    volunteerTutors: "Volunteer Tutors",
    subjectsCovered: "Subjects Covered",
    successRate: "Success Rate",
    
    // Login/Signup
    loginTitle: "Login to EduBridge",
    iamA: "I am a:",
    emailLabel: "Email:",
    emailPlaceholder: "Enter your email",
    passwordLabel: "Password:",
    passwordPlaceholder: "Enter your password",
    login: "Login",
    close: "Close",
    noAccount: "Don't have an account?",
    signupHere: "Sign up here",
    joinEduBridge: "Join EduBridge",
    fullName: "Full Name:",
    fullNamePlaceholder: "Enter your full name",
    createPassword: "Create a password",
    signUp: "Sign Up",
    haveAccount: "Already have an account?",
    loginHere: "Login here"
  },
  hi: {
    home: "होम",
    resources: "संसाधन",
    student: "छात्र",
    tutor: "ट्यूटर",
    logout: "लॉगआउट",
    welcome: "स्वागत है",
    loading: "लोड हो रहा है...",
    save: "सहेजें",
    cancel: "रद्द करें",
    delete: "हटाएं",
    edit: "संपादित करें",
    share: "साझा करें",
    search: "खोजें",
    heroTitle: "सभी के लिए समान शिक्षा के अवसर",
    heroSubtitle: "छात्रों को मुफ्त ऑनलाइन शिक्षा के लिए स्वयंसेवक ट्यूटरों से जोड़ना।",
    getStarted: "शुरू करें",
    shareResource: "संसाधन साझा करें",
    myResources: "मेरे संसाधन",
    allResources: "सभी संसाधन",
    resourceTitle: "शीर्षक",
    resourceDescription: "विवरण",
    resourceCategory: "श्रेणी",
    resourceUrl: "URL",
    myProgress: "मेरी प्रगति",
    subject: "विषय",
    topic: "टॉपिक",
    progress: "प्रगति",
    completed: "पूर्ण",
    inProgress: "प्रगति में",
    notStarted: "शुरू नहीं हुआ",
    selectLanguage: "भाषा चुनें",
    language: "भाषा",
    
    // Features
    whyChoose: "EduBridge क्यों चुनें?",
    freeLearning: "मुफ्त शिक्षा",
    freeLearningDesc: "वित्तीय बाधाओं के बिना गुणवत्तापूर्ण शिक्षा प्राप्त करें",
    expertTutors: "विशेषज्ञ शिक्षक",
    expertTutorsDesc: "उत्साही स्वयंसेवक शिक्षकों से सीखें",
    onlinePlatform: "ऑनलाइन प्लेटफॉर्म",
    onlinePlatformDesc: "कहीं से भी, कभी भी अध्ययन करें",
    progressTracking: "प्रगति ट्रैकिंग",
    progressTrackingDesc: "अपनी सीखने की यात्रा पर नज़र रखें",
    studentsHelped: "छात्रों की मदद की",
    volunteerTutors: "स्वयंसेवक शिक्षक",
    subjectsCovered: "विषय कवर किए गए",
    successRate: "सफलता दर",
    
    // Login/Signup
    loginTitle: "EduBridge में लॉगिन करें",
    iamA: "मैं हूं:",
    emailLabel: "ईमेल:",
    emailPlaceholder: "अपना ईमेल दर्ज करें",
    passwordLabel: "पासवर्ड:",
    passwordPlaceholder: "अपना पासवर्ड दर्ज करें",
    login: "लॉगिन",
    close: "बंद करें",
    noAccount: "खाता नहीं है?",
    signupHere: "यहां साइन अप करें",
    joinEduBridge: "EduBridge में शामिल हों",
    fullName: "पूरा नाम:",
    fullNamePlaceholder: "अपना पूरा नाम दर्ज करें",
    createPassword: "पासवर्ड बनाएं",
    signUp: "साइन अप करें",
    haveAccount: "पहले से खाता है?",
    loginHere: "यहां लॉगिन करें"
  },
  mr: {
    home: "मुख्यपृष्ठ",
    resources: "संसाधने",
    student: "विद्यार्थी",
    tutor: "शिक्षक",
    logout: "बाहेर पडा",
    welcome: "स्वागत आहे",
    loading: "लोड होत आहे...",
    save: "जतन करा",
    cancel: "रद्द करा",
    delete: "हटवा",
    edit: "संपादन करा",
    share: "शेअर करा",
    search: "शोधा",
    heroTitle: "सर्वांसाठी समान शिक्षणाची संधी",
    heroSubtitle: "विद्यार्थ्यांना विनामूल्य ऑनलाइन शिक्षणासाठी स्वयंसेवक शिक्षकांशी जोडणे.",
    getStarted: "सुरू करा",
    shareResource: "संसाधन शेअर करा",
    myResources: "माझी संसाधने",
    allResources: "सर्व संसाधने",
    resourceTitle: "शीर्षक",
    resourceDescription: "वर्णन",
    resourceCategory: "श्रेणी",
    resourceUrl: "URL",
    myProgress: "माझी प्रगती",
    subject: "विषय",
    topic: "विषय",
    progress: "प्रगती",
    completed: "पूर्ण",
    inProgress: "प्रगतीत",
    notStarted: "सुरू नाही",
    selectLanguage: "भाषा निवडा",
    language: "भाषा",
    
    // Features
    whyChoose: "EduBridge का निवडा?",
    freeLearning: "मोफत शिक्षण",
    freeLearningDesc: "आर्थिक अडथळ्यांशिवाय गुणवत्तापूर्ण शिक्षा मिळवा",
    expertTutors: "तज्ञ शिक्षक",
    expertTutorsDesc: "उत्साही स्वयंसेवक शिक्षकांकडून शिका",
    onlinePlatform: "ऑनलाइन प्लॅटफॉर्म",
    onlinePlatformDesc: "कुठेही, कधीही अभ्यास करा",
    progressTracking: "प्रगती ट्रॅकिंग",
    progressTrackingDesc: "तुमच्या शिकण्याच्या प्रवासावर लक्ष ठेवा",
    studentsHelped: "विद्यार्थ्यांना मदत केली",
    volunteerTutors: "स्वयंसेवक शिक्षक",
    subjectsCovered: "विषय कव्हर केले",
    successRate: "यश दर",
    
    // Login/Signup
    loginTitle: "EduBridge मध्ये लॉगिन करा",
    iamA: "मी आहे:",
    emailLabel: "ईमेल:",
    emailPlaceholder: "तुमचा ईमेल प्रविष्ट करा",
    passwordLabel: "पासवर्ड:",
    passwordPlaceholder: "तुमचा पासवर्ड प्रविष्ट करा",
    login: "लॉगिन",
    close: "बंद करा",
    noAccount: "खाते नाही?",
    signupHere: "येथे साइन अप करा",
    joinEduBridge: "EduBridge मध्ये सामील व्हा",
    fullName: "पूर्ण नाव:",
    fullNamePlaceholder: "तुमचे पूर्ण नाव प्रविष्ट करा",
    createPassword: "पासवर्ड तयार करा",
    signUp: "साइन अप करा",
    haveAccount: "आधीपासून खाते आहे?",
    loginHere: "येथे लॉगिन करा"
  }
};

let currentLanguage = localStorage.getItem('language') || 'en';

function t(key) {
  return translations[currentLanguage]?.[key] || translations.en[key] || key;
}

function setLanguage(lang) {
  if (translations[lang]) {
    currentLanguage = lang;
    localStorage.setItem('language', lang);
    
    // Update all language selectors on the page
    document.querySelectorAll('#language-selector').forEach(selector => {
      if (selector) selector.value = lang;
    });
    
    // Update page language immediately
    updatePageLanguage();
    
    // Save to backend if user is logged in
    const token = localStorage.getItem('authToken');
    if (token) {
      fetch('http://localhost:3000/user/language', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ language: lang })
      }).catch(err => console.error('Failed to save language:', err));
    }
    
    // Show notification
    if (typeof showNotification === 'function') {
      const langNames = { en: 'English', hi: 'हिन्दी', mr: 'मराठी' };
      showNotification(`Language changed to ${langNames[lang] || lang}`, 'success');
    }
  }
}

function updatePageLanguage() {
  // Update text content for all elements except options (they need special handling)
  document.querySelectorAll('[data-i18n]').forEach(el => {
    if (el.tagName !== 'OPTION') {
      const key = el.getAttribute('data-i18n');
      if (key) el.textContent = t(key);
    }
  });
  
  // Update option text content
  document.querySelectorAll('option[data-i18n]').forEach(option => {
    const key = option.getAttribute('data-i18n');
    if (key) option.textContent = t(key);
  });
  
  // Update placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18n-placeholder');
    if (key) el.placeholder = t(key);
  });
}

// Initialize language on page load
function initLanguage() {
  // Load saved language
  const savedLang = localStorage.getItem('language') || 'en';
  currentLanguage = savedLang;
  
  // Update all language selectors
  document.querySelectorAll('#language-selector').forEach(selector => {
    if (selector) selector.value = savedLang;
  });
  
  // Update page language
  updatePageLanguage();
  
  // Load from backend if logged in
  const token = localStorage.getItem('authToken');
  if (token) {
    fetch('http://localhost:3000/user/language', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    })
    .then(res => res.json())
    .then(data => {
      if (data.success && data.code) {
        currentLanguage = data.code;
        document.querySelectorAll('#language-selector').forEach(selector => {
          if (selector) selector.value = data.code;
        });
        updatePageLanguage();
      }
    })
    .catch(err => console.error('Failed to load language:', err));
  }
}

// Initialize on DOM ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initLanguage);
} else {
  initLanguage();
}

// Export for use in other scripts
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { t, setLanguage, translations };
}

